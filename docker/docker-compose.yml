services:
  swanson:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        GITHUB_PAT: ${GITHUB_PAT}
        OPENAI_API_KEY: ${OPENAI_API_KEY}
    ports:
      - "18790:18789"
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - CHUNKHOUND_EMBEDDING_API_KEY=${OPENAI_API_KEY}
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN:-swanson-dev-token}
      # MySQL (read-only RDS access)
      - MYSQL_HOST=${MYSQL_HOST:-}
      - MYSQL_PORT=${MYSQL_PORT:-3306}
      - MYSQL_USER=${MYSQL_USER:-}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD:-}
      - MYSQL_DATABASE=${MYSQL_DATABASE:-}
      # Athena (analytics access)
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID:-}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY:-}
      - AWS_REGION=${AWS_REGION:-us-east-1}
    volumes:
      - swanson-threads:/workspace/threads
      - swanson-plans:/workspace/plans
      - swanson-sessions:/workspace/sessions
      - swanson-knowledge:/workspace/knowledge
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:18789/v1/models", "-H", "Authorization: Bearer ${OPENCLAW_GATEWAY_TOKEN:-swanson-dev-token}"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

volumes:
  swanson-threads:
  swanson-plans:
  swanson-sessions:
  swanson-knowledge:
